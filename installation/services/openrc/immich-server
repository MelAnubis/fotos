#!/sbin/openrc-run

: ${data_path:="/usr/src/server"}

name="Immich server"
directory="$data_path"
command=/bin/ash
command_args="-c $data_path/start-server.sh"

command_background=yes
command_user="node:node"
pidfile="/run/immich-server.pid"

output_log="/var/log/immich/server.log"
error_log="/var/log/immich/server.err.log"

required_dirs="$data_path"
required_files="$data_path/start-server.sh"

depend() 
{
#        need postgresql
        need redis
}

# Load env variables
start_pre()
{
        source /etc/profile
}

# Find children process and kill them
stop_pre()
{
	if pgrep -P "$(cat $pidfile)" &> /dev/null
        then
                pkill -P "$(cat $pidfile)"
        fi
}
